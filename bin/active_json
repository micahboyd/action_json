#!/usr/bin/env ruby

$LOAD_PATH.unshift File.join(__FILE__, '..', '..', 'lib')

require 'active_json'
require 'json'

json_path, *args = ARGV

json = IO.read(json_path)

filters, attribute =
  %w[where: pluck:].map { |v| i = args.index(v); args[i+1] if i }

query_result = ActiveJson.select(json, where: filters, pluck: attribute)
pretty_result = JSON.pretty_generate(query_result)

STDOUT.write(pretty_result)
